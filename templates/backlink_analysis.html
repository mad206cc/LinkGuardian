<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi - LinkGuardian</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.skypack.dev/date-fns@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var ctx = document.getElementById('anchorChart').getContext('2d');
        var anchorChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Ancre 1', 'Ancre 2', 'Ancre 3'], // Remplacer par vos données
                datasets: [{
                    label: 'Nombre de backlinks',
                    data: [12, 19, 3], // Remplacer par vos données
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
</script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function() {
        $('#check-all-sites-btn').click(function(e) {
            e.preventDefault(); // Empêche le rechargement de la page
            $.ajax({
                url: '/check_all_sites', // L'URL de votre route Flask
                type: 'POST',
                success: function(response) {
                    // Traitez ici la réponse, par exemple actualiser une partie de votre page
                    console.log('Les sites ont été vérifiés avec succès');
                    // Vous pouvez mettre à jour votre tableau HTML ici avec la réponse reçue
                },
                error: function(error) {
                    console.log('Erreur lors de la vérification des sites', error);
                }
            });
        });
    });
    </script>



    <script>
    document.getElementById('checkSitesButton').addEventListener('click', function() {
        var icon = this.querySelector('i.fa');
        icon.classList.remove('fa-sync-alt');
        icon.classList.add('fa-spinner', 'fa-spin');
        
        // Vous devrez trouver un moyen de détecter lorsque la mise à jour est terminée
        // pour réinitialiser l'icône. Cela pourrait être fait via une requête AJAX
        // ou en utilisant des WebSockets, selon votre configuration backend.
    });
    </script>
    <style>
        /* Styles pour les statuts Follow/Nofollow */
        .indexation-present, .follow-absent {
            padding: 5px 10px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .indexation-present {
            background-color: #5cb85c; /* Vert pour Follow */
        }

        .non-indexe {
            background-color: #FF6347; /* Une couleur rouge pour signifier non indexé */
            color: white; /* Texte blanc pour une meilleure lisibilité */
            padding: 5px 10px;
            border-radius: 4px; /* Pour les coins arrondis */
            display: inline-block;
        }
    </style>
    <style>
        /* Styles pour les statuts Follow/Nofollow */
        .follow-present, .follow-absent {
            padding: 5px 10px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .follow-present {
            background-color: #5cb85c; /* Vert pour Follow */
        }

        .follow-absent {
            background-color: #d9534f; /* Rouge pour Nofollow */
        }
    </style>
    <style>
        /* Styles existants */
        /* ... */

        /* Media Queries pour le responsive design */
        @media (max-width: 768px) {
            .wide-column, .medium-column, .narrow-column {
                min-width: 100%;
            }
            .form-inline, .flex-container {
                flex-direction: column;
                align-items: stretch;
            }
            .table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
    <style>
            /* Classe pour les colonnes larges */
        .wide-column {
            min-width: 180px; /* Ajustez cette valeur selon vos besoins */
        }

        /* Classe pour les colonnes moyennes */ 
        .medium-column {
            min-width: 150px; /* Ajustez cette valeur selon vos besoins */
        }

        /* Classe pour les colonnes étroites */
        .narrow-column {
            min-width: 150px; /* Ajustez cette valeur selon vos besoins */
        }
    </style>
    <style>
            .custom-badge {
                display: inline-block;
                padding: .7em .8em; /* Augmentez le padding pour un badge plus gros */
                font-size: 100%; /* Ajustez la taille de la police selon vos besoins */
                font-weight: 700;
                line-height: 1;
                text-align: center;
                white-space: nowrap;
                vertical-align: baseline;
                border-radius: .25rem;
                color: white;
            }
    </style>
    <style>
        /* Centrage vertical pour toutes les cellules du tableau */
        .table td, .table th {
            vertical-align: middle;
        }

        /* Alignement à gauche pour les URLs */
        .url-cell {
            text-align: left;
        }

        /* Alignement au centre pour les autres cellules */
        .center-cell {
            text-align: center;
        }

        .button-container {
    text-align: center; /* Centrer les boutons horizontalement */
    margin-bottom: 20px; /* Marge en bas pour l'espace */
}

            .custom-button {
                padding: 10px 20px; /* Ajouter un espace intérieur aux boutons */
                margin-right: 10px; /* Marge à droite pour séparer les boutons */
                margin-top: 40px;
                font-size: 16px; /* Taille de la police */
                background-color: #526E83; /* Couleur de fond */
                color: #fff; /* Couleur du texte */
                border: none; /* Supprimer la bordure */
                border-radius: 5px; /* Ajouter un arrondi aux coins */
                cursor: pointer; /* Curseur pointeur au survol */
                transition: background-color 0.3s ease; /* Animation de transition */
            }

            .custom-button:hover {
                background-color: #526E83; /* Couleur de fond au survol */
            }
    </style>
    <style>
        .badge {
        color: white;
        padding: 5px 10px;
        font-size: 0.9em;
        border-radius: 5px;
        display: inline-block;
        }
    </style>
    <style>
    .table-button {
        width: 150px;
         /* ou toute autre taille */
    }
    </style>
    <style>
        

        .table thead th a {
            color: white; /* Couleur des liens */
            text-decoration: none; /* Pas de soulignement */
            transition: color 0.3s; /* Transition pour le survol */
        }

        .table thead th a:hover {
            color: #ccc; /* Couleur au survol */
        }

        /* Icônes de tri (exemple avec FontAwesome) */
        .table thead th .fa-sort { /* Icône par défaut */
            color: #ddd;
        }

        .table thead th .fa-sort-up, /* Icône tri ascendant */
        .table thead th .fa-sort-down { /* Icône tri descendant */
            color: white;
        }
    </style>
    <style>
        /* Style général du tableau */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            font-size: 0.9em;
            font-family: sans-serif;
            min-width: 400px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        }

        /* Style des en-têtes du tableau */
        .table thead tr {
            background-color: #526E83;
            color: white;
            text-align: left;
        }

        /* Style des cellules du tableau */
        .table th,
        .table td {
            padding: 12px 15px;
        }

        /* Style des lignes alternées */
        .table tbody tr {
            border-bottom: 1px solid #dddddd;
        }

        .table tbody tr:nth-of-type(even) {
            background-color: #f3f3f3;
        }

        .table tbody tr:last-of-type {
            border-bottom: 2px solid #526E83;
        }

        /* Style au survol d'une ligne */
        .table tbody tr:hover {
            background-color: #f1f1f1;
        }

        /* Style pour les boutons ou liens dans le tableau */
        .table-button {
            padding: 5px 10px;
            color: white;
            background-color: #009879;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .table-button:hover {
            background-color: #007b5e;
        }
        

        /* Style pour les tags et les états */
        .tag, .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            text-align: center;
            min-width: 80px; /* Ajustez selon vos besoins */
        }

        /* Style spécifique pour les états */
        .link-present, .anchor-present {
            background-color: #5cb85c; /* Vert */
            color: white;
            padding: 5px 10px;
            color: white;
            background-color: #d9534f; /* Rouge */
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .link-absent, .anchor-absent {
            background-color: #f0ad4e; /* Orange */
            color: white;
            padding: 5px 10px;
            color: white;
            background-color: #d9534f; /* Rouge */
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Vous pouvez ajouter des styles spécifiques pour chaque tag si nécessaire */
        .tag-promovacances {
            background-color: #0064DC;
            color: white;
        }

        /* Style général du tableau */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        /* Style de l'en-tête du tableau */
        th {
            background-color: #4E5D6C; /* Couleur de fond de l'en-tête */
            color: white; /* Couleur du texte de l'en-tête */
            text-align: left; /* Alignement du texte */
            padding: 12px 15px; /* Espacement interne */
            font-size: 16px; /* Taille de la police */
            border-bottom: 2px solid #dee2e6; /* Bordure en bas de l'en-tête */
        }

        /* Style des cellules du tableau */
        td {
            padding: 10px 15px; /* Espacement interne */
            border-bottom: 1px solid #dee2e6; /* Bordure en bas de chaque cellule */
        }

        /* Style des liens dans l'en-tête pour le tri */
        th a {
            color: white; /* Couleur des liens */
            text-decoration: none; /* Pas de soulignement */
        }

        th a:hover {
            text-decoration: underline; /* Soulignement au survol */
        }
        
    </style>
    <style>
        .form-inline {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px; /* Espace entre les éléments */
            padding: 20px;
            background-color: #f7f7f7;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 0; /* Pas de marge en bas pour un alignement sur une ligne */
        }

        .form-control {
            width: auto; /* Largeur automatique pour s'adapter au contenu */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .btn {
            padding: 5px;
            border: none;
            border-radius: 4px;
            background-color: #526E83;
            color: white;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #0056B3;
        }
        .btn-primary {
        padding: 10px 20px;
        background-color: #526e83;
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            color: white;
        }

        .btn-primary:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5);
        }
        /* Style pour le bouton Supprimer */
        .delete-button {
            padding: 5px 10px;
            color: white;
            background-color: #8B0000; /* Rouge */
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .delete-button:hover {
            background-color: #8B0000; /* Rouge foncé */
        }
        .flex-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-control {
            flex-grow: 1; /* Permet au champ de saisie de remplir l'espace disponible */
            margin-right: 10px; /* Ajoute un peu d'espace entre le champ de saisie et le bouton */
        }
        .header {
            display: flex;
            align-items: center;
        }

        .logo {
            width: 100px; /* ou la taille que vous souhaitez */
            margin-right: 10px;
        }
        @font-face {
            font-family: 'Blacksword';
            src: url('static/Blacksword.otf') format('opentype');
        }

        .signature {
            font-family: 'Blacksword', cursive; /* Nom de la police que vous avez choisie */
            font-size: 12px; /* Taille de la police */
            text-align: right; /* Alignement à droite */
            position: absolute;
            bottom: 10px;
            right: 10px;
        }

        footer {
            position: relative;
            height: 60px; /* ou la hauteur que vous souhaitez */
        }
        .button-group {
            display: flex;
            align-items: center;
            gap: 10px; /* Espace entre les boutons */
        }

        .button-group .btn {
            padding: 10px 15px;
            text-decoration: none;
            color: white;
            border-radius: 5px;
            /* Ajoutez d'autres styles de bouton ici si nécessaire */
        }

        .btn-secondary {
            background-color: #6c757d; /* Couleur pour le bouton secondaire */
        }

        .btn-secondary:hover {
            background-color: #5a6268; /* Couleur plus foncée au survol */
        }
        .btn i {
        font-size: 12px; /* Réduire la taille de l'icône */
        margin-right: 5px; /* Ajoute un peu d'espace entre l'icône et le texte */
        }
        th a {
            display: flex;
            align-items: center;
        }

        th a i {
            margin-left: 5px; /* Ajustez selon vos besoins */
        }
        .fa-external-link-alt {
        color: #6C757D; /* Couleur de l'icône */
        margin-left: 5px;
        font-size: 70%; /* Espace entre le texte et l'icône */
        }
        .user-profile {
        display: flex;
        align-items: center;
        }

        .user-image {
        width: 40px; /* ou la taille que vous souhaitez */
        height: 40px; /* doit être égal à la largeur pour être un cercle */
        border-radius: 50%; /* ceci rend l'image ronde */
        object-fit: cover; /* assurez-vous que l'image couvre le cercle sans être déformée */
        margin-right: 10px; /* espace entre l'image et le texte */
        }

        .username {
        font-size: 16px; /* ou la taille de police que vous souhaitez */
        /* ajoutez ici d'autres styles pour le texte si nécessaire */
        }
        .user-profile {
        position: relative;
        display: inline-block;
        cursor: pointer;
        }

        .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        }

        .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        }

        .user-profile:hover .dropdown-content {
        display: block;
        }

   .chart-container {
    padding: 20px;
    background-color: #f8f8f8;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
    }

    .chart-container h2 {
        color: #333;
        font-size: 24px;
        margin-bottom: 20px;
    }

    .chart-container1 {
    padding: 20px;
    background-color: #f8f8f8;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
    }

    .chart-container1 h2 {
        color: #333;
        font-size: 24px;
        margin-bottom: 20px;
    }


    canvas {
        width: 100% !important;
        height: auto !important;
    }

.container {
    margin-top: 30px; /* Ajoutez plus d'espace en haut */
}
#anchor-chart-container {
    display: block;
    width: 100%;
    max-width: 300px; /* ajustez la largeur selon vos besoins */
     /* ajustez la hauteur selon vos besoins */
    margin: auto; /* pour centrer le graphique si nécessaire */
}
#site-chart-container {
    display: block;
    width: 100%;
    max-width: 300px; /* ajustez la largeur selon vos besoins */
     /* ajustez la hauteur selon vos besoins */
    margin: auto; /* pour centrer le graphique si nécessaire */
}

#source-url-pie-chart-container {
    display: block;
    width: 100%;
    max-width: 300px; /* ajustez la largeur selon vos besoins */
     /* ajustez la hauteur selon vos besoins */
    margin: auto; /* pour centrer le graphique si nécessaire */
}

.max-height-select {
    max-height: 150px;
    overflow-y: auto;
}
.small-width-select {
    width: 150px; 
}


    </style>    
</head>
<body>    
    <div class="container-fluid">
      <!-- Barre de navigation avec les liens -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <!-- Logo et nom de l'outil alignés verticalement -->
                <a class="navbar-brand" href="/">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" style="height: 80px;">
                    LinkGuardian
                </a>
                <!-- Bouton pour le menu hamburger -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedMenu" aria-controls="navbarSupportedMenu" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <!-- Menu déroulant pour les liens de navigation -->
                <div class="collapse navbar-collapse" id="navbarSupportedMenu">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/">Accueil</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/backlink-analysis">Analyse des Backlinks</a>
                        </li>
                        <!-- Ajoutez d'autres éléments de navigation si nécessaire -->
                    </ul>
                    <div class="user-profile">
                        <img src="/static/utilisateur.png" alt="User" class="user-image">
                        <span class="username">{{ username }}</span>
                        <div class="dropdown-content">
                            <a href="{{ url_for('configuration') }}">Configuration</a>
                            <a href="{{ url_for('logout') }}">Déconnecter</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="button-container"  style="margin-top: 30px;">
            <button id="repartitionParAncre" class="custom-button">Répartition par Ancre</button>
            <button id="repartitionParSite" class="custom-button">Répartition par Site</button>
        </div>
        
      
        
   
        <div id="repartitionParAncreGraphs">

            <div>
                <H4 style="margin-left: 630px; margin-top: 80px; margin-bottom: 120px; font-size: 36px;">La répartition des graphs pas Ancre</H4>
             </div>

             <div id="selector-container" style="margin-top: -50px; margin-left: 200px;">
                <label for="site-selector" style="font-size: 25px;">Choisissez un site :</label>
                <select id="site-selector-options">
                    <!-- Option vide par défaut -->
                    <option value="">Sélectionnez un site</option>
            
                    <!-- Options dynamiques depuis tag_data -->
                    {% for tag in tag_data %}
                        <option value="{{ tag.tag }}">{{ tag.tag }}</option>
                    {% endfor %}
                </select>
            </div>

            <script>
                // Récupérez la balise select
                var selector = document.getElementById('site-selector-options');
            
                // Fonction pour mettre à jour les statistiques d'ancres sur la page
                function updateAnchorStatistics(data) {
                    var anchorTable = document.querySelector('#anchor-table-container table');
                    // Supprimez toutes les lignes existantes sauf l'en-tête
                    while (anchorTable.rows.length > 1) {
                        anchorTable.deleteRow(1);
                    }
                    // Ajoutez les nouvelles données
                    data.forEach(function(anchor) {
                        var row = anchorTable.insertRow();
                        var cell1 = row.insertCell(0);
                        var cell2 = row.insertCell(1);
                        var cell3 = row.insertCell(2);
                        cell1.textContent = anchor.anchor;
                        cell2.textContent = anchor.count;
                        cell3.textContent = anchor.percentage.toFixed(2) + '%';
                    });
                }
            
                // Faites une requête AJAX pour récupérer les données d'ancres selon le tag sélectionné
                function fetchDataAndUpdate(selectedTag) {
                    fetch('/get_anchor_data_tag?tag=' + selectedTag)
                        .then(function(response) {
                            // Vérifiez si la réponse est ok
                            if (!response.ok) {
                                throw new Error('Erreur lors de la récupération des données d\'ancres');
                            }
                            // Analysez la réponse JSON
                            return response.json();
                        })
                        .then(function(data) {
                            // Réponse de la requête réussie
                            // Vous pouvez traiter les données reçues ici et les afficher dans votre page
                            // Example: Update the anchor statistics on your webpage
                            updateAnchorStatistics(data);
                        })
                        .catch(function(error) {
                            // Gestion des erreurs de la requête
                            console.error(error);
                        });
                }
            
                // Ajoutez un écouteur d'événements pour écouter les changements de sélection
                selector.addEventListener('change', function() {
                    var selectedTag = selector.value;
                    fetchDataAndUpdate(selectedTag);
                });
            
                // Sélectionnez la première option après "Sélectionnez un site" par défaut et mettez à jour les données
                document.addEventListener('DOMContentLoaded', function() {
                    var selectedTag = selector.options[1].value;
                    fetchDataAndUpdate(selectedTag);
                });
            </script>
            
         

        <div class="container" style=" margin-top: 90px;">
            <!-- Première ligne : Tableau à gauche, Graphique à droite -->
            <div class="row mb-4">
                <div class="col-lg-6 col-12 mb-4">
                    <!-- Tableau des Ancres -->
                    <div class="table-container" id="anchor-table-container">
                        <h2>Tableau des Ancres</h2>
                        <table>
                            <tr>
                                <th>Ancre</th>
                                <th>Nombre</th>
                                <th>Pourcentage</th>
                            </tr>
                            <!-- Les données d'ancres seront ajoutées ici dynamiquement -->
                        </table>
                    </div>
                </div>
                

                <div class="col-lg-6 col-12 mb-4">
                    <!-- Graphique des Ancres -->
                    <div id="anchor-chart-container" class="chart-container">
                        <h2>Répartition des Backlinks par Ancre</h2>
                        <canvas id="anchorPieChart" width="200" height="200"></canvas>
                        <!-- Script pour le graphique en camembert -->
                        <script>
                            
                            function updateAnchorChart(data) {
                                var anchorLabels = data.map(item => item.anchor);
                                var anchorCounts = data.map(item => item.count);

                                // Vérifiez si une instance de graphique existe déjà et si elle est valide
                                if (window.anchorPieChart instanceof Chart && typeof window.anchorPieChart.destroy === 'function') {
                                    window.anchorPieChart.destroy(); // Détruisez l'instance existante du graphique
                                }

                                var ctx = document.getElementById('anchorPieChart').getContext('2d');
                                window.anchorPieChart = new Chart(ctx, {
                                    type: 'pie',
                                    data: {
                                        labels: anchorLabels,
                                        datasets: [{
                                            data: anchorCounts,
                                            backgroundColor: generateRandomColors(anchorLabels.length)
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: true
                                    }
                                });
                            }
                
                            // Fonction pour récupérer les données des Ancres en fonction du tag sélectionné
                            function fetchAnchorDataAndUpdate(tag) {
                                fetch('/get_anchor_data_tag?tag=' + tag)
                                    .then(response => response.json())
                                    .then(data => {
                                        updateAnchorChart(data);
                                    })
                                    .catch(error => console.error('Erreur lors de la récupération des données d\'ancres : ', error));
                            }
                
                            // Fonction pour générer des couleurs aléatoires
                            function generateRandomColors(numColors) {
                                var colors = [];
                                for (var i = 0; i < numColors; i++) {
                                    var randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);
                                    colors.push(randomColor);
                                }
                                return colors;
                            }
                
                            // Ajoutez un écouteur d'événements pour détecter les changements de sélection
                            document.getElementById('site-selector-options').addEventListener('change', function() {
                                var selectedTag = this.value;
                                fetchAnchorDataAndUpdate(selectedTag);
                            });
                
                            // Sélectionnez la première option après "Sélectionnez un site" par défaut et mettez à jour les données
                            document.addEventListener('DOMContentLoaded', function() {
                                // Récupérer la première option après "Sélectionnez un site"
                            var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
                            
                            // Vérifier si une option est trouvée
                            if (defaultTagOption) {
                                var selectedTag = defaultTagOption.value;
                                fetchAnchorDataAndUpdate(selectedTag);
                            } else {
                                console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                            }
                            });
                        </script>
                    </div>
                </div>

            <!-- Deuxième ligne : Graphique à gauche, Tableau à droite -->
            <div class="row mb-4">
                <div class="col-lg-6 col-12 mb-4">
                    <!-- Graphique des Statuts HTTP -->
                    <div id="http-status-chart-container" class="chart-container">
                        <h2>Statut HTTP des Backlinks</h2>
                        <canvas id="httpStatusChart"></canvas>
                    </div>
                </div>
                <script>
            function generateRandomColors(numColors) {
            var colors = [];
            for (var i = 0; i < numColors; i++) {
                var randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);
                colors.push(randomColor);
            }
            return colors;
          }
          var httpStatusChart = null;
          // Fonction pour mettre à jour le graphique des statuts HTTP
            function updateHttpStatusChart(data) {
                var ctx = document.getElementById('httpStatusChart').getContext('2d');
                
                // Vérifiez si une instance de graphique existe déjà
                if (httpStatusChart instanceof Chart) {
                    httpStatusChart.destroy(); // Détruisez l'instance existante du graphique
                }

                httpStatusChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['200', '3XX', '4XX', '5XX'],
                        datasets: [{
                            label: 'Nombre de Pages',
                            data: [data['200'], data['3XX'], data['4XX'], data['5XX']],
                            backgroundColor: generateRandomColors(4),
                            borderColor: generateRandomColors(4),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

        // Fonction pour récupérer les données des statuts HTTP en fonction du tag sélectionné
        function fetchStatusDataAndUpdate(tag) {
            
            fetch('/get_status_count_tag?tag=' + tag)
                .then(response => response.json())
                .then(data => {
                   
                    updateHttpStatusChart(data);
                })
                .catch(error => console.error('Erreur lors de la récupération des données de statut : ', error));
        }

                    document.addEventListener('DOMContentLoaded', function() {
                // Gestionnaire d'événements pour la sélection d'un nouveau tag
                document.getElementById('site-selector-options').addEventListener('change', function() {
                    var selectedTag = this.value; // Récupérer la valeur sélectionnée dans la liste déroulante
                    fetchStatusDataAndUpdate(selectedTag); // Mettre à jour les données du graphique en fonction du tag sélectionné
                });

                // Appel initial pour afficher les données par défaut
                var options = document.querySelectorAll('#site-selector-options option');
                var defaultTagOption = null;

                // Trouver la deuxième option après celle avec la valeur vide
                for (var i = 0; i < options.length; i++) {
                    if (options[i].value !== "") {
                        defaultTagOption = options[i].value;
                        break;
                    }
                }

                if (defaultTagOption !== null) {
                    fetchStatusDataAndUpdate(defaultTagOption);
                } else {
                    console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                }
            });
                </script>



                <div class="col-lg-6 col-12 mb-4">
                    <!-- Tableau des Statuts HTTP -->
                    <div class="table-container">
                        <h2>Tableau des Statuts HTTP</h2>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Statut HTTP</th>
                                    <th>Nombre de Pages</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td  class="status-code" >200</td>
                                    <td class="status-count" id="status-200" >{{ status_counts['200'] }}</td>
                                </tr>
                                <tr>
                                    <td  class="status-code">3XX</td>
                                    <td class="status-count" id="status-3XX">{{ status_counts['3XX'] }}</td>
                                </tr>
                                <tr>
                                    <td  class="status-code">4XX</td>
                                    <td class="status-count" id="status-4XX">{{ status_counts['4XX'] }}</td>
                                </tr>
                                <tr>
                                    <td  class="status-code">5XX</td>
                                    <td class="status-count" id="status-5XX">{{ status_counts['5XX'] }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <script>
                // Fonction pour récupérer les données des statuts HTTP en fonction du tag sélectionné
                function fetchStatusCountsAndUpdate(tag) {
                fetch('/get_status_count_tag?tag=' + tag)
                    .then(response => response.json())
                    .then(data => {
                        
                        // Mettre à jour les données dans le tableau
                        Object.keys(data).forEach(statusCode => {
                            const count = data[statusCode];
                            // Sélectionner les éléments par leur classe et mettre à jour leur contenu
                            const statusCountElement = document.querySelector('.status-count#status-' + statusCode);
                            if (statusCountElement) {
                                statusCountElement.textContent = count;
                            }
                        });
                    })
                    .catch(error => console.error('Erreur lors de la récupération des données de statut : ', error));
            }

                document.addEventListener('DOMContentLoaded', function() {
                    // Gestionnaire d'événements pour la sélection d'un nouveau tag
                    document.getElementById('site-selector-options').addEventListener('change', function() {
                        var selectedTag = this.value; // Récupérer la valeur sélectionnée dans la liste déroulante
                        fetchStatusCountsAndUpdate(selectedTag); // Mettre à jour les données du tableau en fonction du tag sélectionné
                    });
            
                    // Appel initial pour afficher les données par défaut
                    var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
                    if (defaultTagOption) {
                        var selectedTag = defaultTagOption.value;
                        fetchStatusCountsAndUpdate(selectedTag);
                    } else {
                        console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                    }
                });
            </script>
        </div>
       

        <!-- Ligne pour le graphique Follow vs NoFollow et son tableau -->
        <div class="container">
            <div class="row mb-4">
                <div class="col-lg-6 col-12 mb-4">
                    <!-- Tableau Follow vs NoFollow -->
                    <div class="table-container">
                        <h2>Tableau Follow vs NoFollow</h2>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Type de Lien</th>
                                    <th>Nombre de Liens</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Follow</td>
                                    <td id="follow-count-follow">{{ follow_counts['follow'] }}</td>
                                </tr>
                                <tr>
                                    <td>NoFollow</td>
                                    <td id="follow-count-nofollow">{{ follow_counts['nofollow'] }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <script>
                        function fetchFollowCountsAndUpdate(tag) {
                            fetch('/get_follow_counts_tag?tag=' + tag)
                                .then(response => response.json())
                                .then(data => {
                                   
                                    // Mettre à jour les données dans le tableau
                                    document.getElementById('follow-count-follow').textContent = data.follow;
                                    document.getElementById('follow-count-nofollow').textContent = data.nofollow;
                                })
                                .catch(error => console.error('Erreur lors de la récupération des données follow_counts : ', error));
                        }
                    
                        document.addEventListener('DOMContentLoaded', function() {
                            // Gestionnaire d'événements pour la sélection d'un nouveau tag
                            document.getElementById('site-selector-options').addEventListener('change', function() {
                                var selectedTag = this.value; // Récupérer la valeur sélectionnée dans la liste déroulante
                                fetchFollowCountsAndUpdate(selectedTag); // Mettre à jour les données du tableau en fonction du tag sélectionné
                            });
                    
                            // Appel initial pour afficher les données par défaut
                            var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
                            if (defaultTagOption) {
                                var selectedTag = defaultTagOption.value;
                                fetchFollowCountsAndUpdate(selectedTag);
                            } else {
                                console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                            }
                        });
                    </script>

                </div>


                <div class="col-lg-6 col-12 mb-4">
                    <div class="chart-container" style="max-height: 400px;">
                    <!-- Graphique Follow vs NoFollow -->
                        <div id="follow-nofollow-chart-container" class="chart-container">
                            <h2>Follow vs NoFollow</h2>
                            <canvas id="followNoFollowChart"></canvas>
                        </div>
                        <script>
                            document.addEventListener('DOMContentLoaded', function() {
                                function generateRandomColors(numColors) {
                                    var colors = [];
                                    for (var i = 0; i < numColors; i++) {
                                        var randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);
                                        colors.push(randomColor);
                                    }
                                    return colors;
                                }
                    
                                function fetchFollowCountsAndUpdate(tag) {
                                        fetch('/get_follow_counts_tag?tag=' + tag)
                                            .then(response => response.json())
                                            .then(data => {
                                                var ctx = document.getElementById('followNoFollowChart').getContext('2d');
                                                
                                                // Détruire le graphique existant s'il y en a un
                                                if (window.followNoFollowChart instanceof Chart) {
                                                    window.followNoFollowChart.destroy();
                                                }

                                                window.followNoFollowChart = new Chart(ctx, {
                                                    type: 'bar',
                                                    data: {
                                                        labels: ['Follow', 'NoFollow'],
                                                        datasets: [{
                                                            label: 'Nombre de Liens',
                                                            data: [data.follow, data.nofollow],
                                                            backgroundColor: generateRandomColors(2),
                                                            borderColor: generateRandomColors(2),
                                                            borderWidth: 1
                                                        }]
                                                    },
                                                    options: {
                                                        scales: {
                                                            y: {
                                                                beginAtZero: true
                                                            }
                                                        }
                                                    }
                                                });
                                            })
                                            .catch(error => console.error('Erreur lors de la récupération des données follow_counts : ', error));
                                    }
                    
                                // Gestionnaire d'événements pour la sélection d'un nouveau tag
                                document.getElementById('site-selector-options').addEventListener('change', function() {
                                    var selectedTag = this.value; // Récupérer la valeur sélectionnée dans la liste déroulante
                                    fetchFollowCountsAndUpdate(selectedTag); // Mettre à jour les données du graphique en fonction du tag sélectionné
                                });
                    
                                // Appel initial pour afficher les données par défaut
                                var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
                                if (defaultTagOption) {
                                    var selectedTag = defaultTagOption.value;
                                    fetchFollowCountsAndUpdate(selectedTag);
                                } else {
                                    console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                                }
                            });
                        </script>
                    </div>
                </div>
            <!-- Ajoutez d'autres lignes et colonnes pour les autres graphiques et tableaux selon ce modèle -->


            
  <!-- ********************************************************MES DIAGRAMMES*******************************************************************************************-->     
            <div class="col-lg-6 col-12 mb-4">
                <!-- Graphique de Répartition des URLs Source -->
                <div id="source-url-pie-chart-container" class="chart-container">
                    <h2>Répartition des URLs Source</h2>
                    <canvas id="sourceUrlPieChart" width="300" height="300"></canvas>
                    <!-- Script pour le graphique en camembert -->
                    <script>
                        function generateRandomColors(numColors) {
                            var colors = [];
                            for (var i = 0; i < numColors; i++) {
                                var randomColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
                                colors.push(randomColor);
                            }
                            return colors;
                        }
                    
                        function fetchSourceUrlCountsAndUpdate(tag) {
                        fetch('/get_source_url_counts_tag?tag=' + tag)
                            .then(response => response.json())
                            .then(data => {
                                var sourceUrlLabels = ['Présentes', 'Absentes'];
                                var sourceUrlCounts = [data['Lien présent'], data['Lien absent']];

                                // Récupérer l'objet Chart existant s'il existe
                                var existingChart = window.sourceUrlPieChart;

                                // Si un graphique existant est trouvé et qu'il a la méthode destroy, le détruire
                                if (existingChart && typeof existingChart.destroy === 'function') {
                                    existingChart.destroy();
                                }

                                var ctxSourceUrl = document.getElementById('sourceUrlPieChart').getContext('2d');
                                window.sourceUrlPieChart = new Chart(ctxSourceUrl, {
                                    type: 'pie',
                                    data: {
                                        labels: sourceUrlLabels,
                                        datasets: [{
                                            data: sourceUrlCounts,
                                            backgroundColor: generateRandomColors(2)
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: true,
                                    }
                                });
                            })
                            .catch(error => console.error('Erreur lors de la récupération des données source_url_counts : ', error));
                    }
                    
                        // Appel initial pour afficher les données par défaut
                        document.addEventListener('DOMContentLoaded', function () {
                            // Gestionnaire d'événements pour la sélection d'un nouveau tag
                            document.getElementById('site-selector-options').addEventListener('change', function () {
                                var selectedTag = this.value; // Récupérer la valeur sélectionnée dans la liste déroulante
                                fetchSourceUrlCountsAndUpdate(selectedTag); // Mettre à jour les données du graphique en fonction du tag sélectionné
                            });
                    
                            // Appel initial pour afficher les données par défaut
                            var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
                            if (defaultTagOption) {
                                var selectedTag = defaultTagOption.value;
                                fetchSourceUrlCountsAndUpdate(selectedTag);
                            } else {
                                console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                            }
                        });
                    </script>
                </div>
            </div>

            <!-- Graphique de Statut d'Indexation Google par Ancre -->
            <div class="col-lg-6 col-12 mb-4">
                 <div id="google-index-chart-container" class="chart-container">
                      <h2>Statut d'Indexation Google par Ancre</h2>
                         <canvas id="googleIndexChart"></canvas>
                 </div>
            </div>
            <script>
                function generateRandomColors(numColors) {
                    var colors = [];
                    for (var i = 0; i < numColors; i++) {
                        var randomColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
                        colors.push(randomColor);
                    }
                    return colors;
                }
            
                function fetchGoogleIndexDataAndUpdate(tag) {
                        fetch('/get_google_index_data_tag?tag=' + tag)
                            .then(response => response.json())
                            .then(data => {
                                var ctx = document.getElementById('googleIndexChart').getContext('2d');
                                var existingChart = window.googleIndexChart;

                                // Si un graphique existant est trouvé et qu'il a la méthode destroy, le détruire
                                if (existingChart && typeof existingChart.destroy === 'function') {
                                    existingChart.destroy();
                                }

                                window.googleIndexChart = new Chart(ctx, {
                                    type: 'bar',
                                    data: {
                                        labels: data.labels,
                                        datasets: [{
                                            label: 'Indexé',
                                            data: data.indexedCounts,
                                            backgroundColor: generateRandomColors(data.labels.length),
                                            borderColor: generateRandomColors(data.labels.length),
                                            borderWidth: 1
                                        }, {
                                            label: 'Non indexé',
                                            data: data.notIndexedCounts,
                                            backgroundColor: generateRandomColors(data.labels.length),
                                            borderColor: generateRandomColors(data.labels.length),
                                            borderWidth: 1
                                        }]
                                    },
                                    options: {
                                        scales: {
                                            x: {
                                                stacked: true
                                            },
                                            y: {
                                                stacked: true
                                            }
                                        }
                                    }
                                });
                            })
                            .catch(error => console.error('Erreur lors de la récupération des données google_index_data : ', error));
                    }
            
                // Appel initial pour afficher les données par défaut
                document.addEventListener('DOMContentLoaded', function () {
                    // Gestionnaire d'événements pour la sélection d'un nouveau tag
                    document.getElementById('site-selector-options').addEventListener('change', function () {
                        var selectedTag = this.value; // Récupérer la valeur sélectionnée dans la liste déroulante
                        fetchGoogleIndexDataAndUpdate(selectedTag); // Mettre à jour les données du graphique en fonction du tag sélectionné
                    });
            
                    // Appel initial pour afficher les données par défaut
                    var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
                    if (defaultTagOption) {
                        var selectedTag = defaultTagOption.value;
                        fetchGoogleIndexDataAndUpdate(selectedTag);
                    } else {
                        console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                    }
                });
            </script>
           

<div class="col-lg-6 col-12 mb-4">
    <div id="scatterPlotChartContainer" class="chart-container">
        <h2>Comparaison Page Value et Page Trust</h2>
        <canvas id="scatterPlotChart" width="400" height="400"></canvas>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var scatterPlotCtx = document.getElementById('scatterPlotChart').getContext('2d');
                var scatterPlotChart;
        
                function getRandomColor() {
                    var letters = '0123456789ABCDEF';
                    var color = '#';
                    for (var i = 0; i < 6; i++) {
                        color += letters[Math.floor(Math.random() * 16)];
                    }
                    return color;
                }
        
                function fetchPageComparisonDataAndUpdate(tag) {
                    fetch('/get_page_comparison_data?tag=' + tag)
                        .then(response => response.json())
                        .then(data => {
                            var scatterPlotData = {
                                datasets: []
                            };
        
                            data.page_value_data.forEach(function (pageValue) {
                                var randomColor = getRandomColor();
                                var urlDataset = {
                                    label: pageValue.url,
                                    data: [{
                                        x: pageValue.page_value,
                                        y: findPageTrust(pageValue.url, data.page_trust_data),
                                    }],
                                    backgroundColor: randomColor,
                                    borderColor: randomColor,
                                    borderWidth: 1,
                                    pointRadius: 8,
                                    pointHoverRadius: 10,
                                };
                                scatterPlotData.datasets.push(urlDataset);
                            });
        
                            if (scatterPlotChart) {
                                scatterPlotChart.destroy();
                            }
        
                            scatterPlotChart = new Chart(scatterPlotCtx, {
                                type: 'scatter',
                                data: scatterPlotData,
                                options: {
                                    scales: {
                                        x: {
                                            type: 'linear',
                                            position: 'bottom',
                                            title: {
                                                display: true,
                                                text: 'Page Value',
                                            },
                                        },
                                        y: {
                                            type: 'linear',
                                            position: 'left',
                                            title: {
                                                display: true,
                                                text: 'Page Trust',
                                            },
                                        },
                                    },
                                    plugins: {
                                        datalabels: false
                                    },
                                    onHover: function (event, chartElement) {
                                        event.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
        
                                        if (chartElement[0]) {
                                            var dataset = scatterPlotData.datasets[chartElement[0].datasetIndex];
                                            var label = dataset.label;
                                            var url = dataset.url;
        
                                            console.log("URL:", url);
                                        }
                                    }
                                },
                            });
                        })
                        .catch(error => console.error('Erreur lors de la récupération des données de comparaison : ', error));
                }
        
                function findPageTrust(url, pageTrustData) {
                    var matchingData = pageTrustData.find(function (data) {
                        return data.url === url;
                    });
        
                    return matchingData ? matchingData.page_trust : 0;
                }
        
                // Gestionnaire d'événements pour la sélection d'un nouveau tag
                document.getElementById('site-selector-options').addEventListener('change', function () {
                    var selectedTag = this.value;
                    fetchPageComparisonDataAndUpdate(selectedTag);
                });
        
                // Appel initial pour afficher les données par défaut
                var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
                if (defaultTagOption) {
                    var selectedTag = defaultTagOption.value;
                    fetchPageComparisonDataAndUpdate(selectedTag);
                } else {
                    console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                }
            });
        </script>
    </div>
</div>

<div class="col-lg-6 col-12 mb-4">
    <div id="anchorDiversityChartContainer" class="chart-container">
        <h2>Diversité des Ancres</h2>
        <canvas id="anchorDiversityChart" width="400" height="400"></canvas>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Gestionnaire d'événements pour la sélection d'un nouveau tag
        document.getElementById('site-selector-options').addEventListener('change', function () {
            var selectedTag = this.value; // Récupérer la valeur sélectionnée dans la liste déroulante
            fetchAnchorDiversityDataAndUpdate(selectedTag); // Mettre à jour les données du graphique en fonction du tag sélectionné
        });
    
        // Appel initial pour afficher les données par défaut
        var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
        if (defaultTagOption) {
            var selectedTag = defaultTagOption.value;
            fetchAnchorDiversityDataAndUpdate(selectedTag);
        } else {
            console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
        }
    });
    
    // Fonction pour récupérer les données de diversité des ancres et mettre à jour le graphique
    function fetchAnchorDiversityDataAndUpdate(tag) {
        fetch('/get_anchor_diversity_data?tag=' + tag)
            .then(response => response.json())
            .then(data => {
                // Créer une liste de couleurs pour chaque ancre
                var colors = generateColors(data.length);
    
                // Récupérer le graphique existant s'il existe déjà
                var anchorDiversityChart = Chart.getChart("anchorDiversityChart");
    
                // Si le graphique existe déjà, mettre à jour ses données
                if (anchorDiversityChart) {
                    anchorDiversityChart.data.labels = data.map(data => data.anchor);
                    anchorDiversityChart.data.datasets[0].data = data.map(data => data.count);
                    anchorDiversityChart.data.datasets[0].backgroundColor = colors;
                    anchorDiversityChart.data.datasets[0].borderColor = colors;
                    anchorDiversityChart.update(); // Mettre à jour le graphique
                } else {
                    // Si le graphique n'existe pas, créer un nouveau graphique
                    var anchorDiversityChartData = {
                        labels: data.map(data => data.anchor),
                        datasets: [{
                            label: 'Nombre d\'ancres uniques',
                            data: data.map(data => data.count),
                            backgroundColor: colors,
                            borderColor: colors,
                            borderWidth: 1,
                        }]
                    };
    
                    // Obtenez le contexte du graphique et créez le graphique
                    var anchorDiversityChartCtx = document.getElementById('anchorDiversityChart').getContext('2d');
                    var anchorDiversityChart = new Chart(anchorDiversityChartCtx, {
                        type: 'bar',  
                        data: anchorDiversityChartData,
                        options: {
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Ancres Uniques',
                                    },
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'URLs',
                                    },
                                }
                            }
                        },
                    });
                }
            })
            .catch(error => console.error('Erreur lors de la récupération des données de diversité des ancres : ', error));
    }
    
    // Fonction pour générer des couleurs de manière aléatoire
    function generateColors(count) {
        var colors = [];
        for (var i = 0; i < count; i++) {
            colors.push(getRandomColor());
        }
        return colors;
    }
    
    // Fonction pour générer une couleur aléatoire
    function getRandomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }
    </script>

<div class="col-lg-6 col-12 mb-4">
    <div id="barChartContainer" class="chart-container">
        <h2>Graphique temporelle</h2>
        <div class="row">
            <div class="col-lg-4 col-12 mb-4">
                <h2>Ancre:</h2>
                <select id="anchorSelector" class="form-select">
                </select>
            </div>
            <div class="col-lg-4 col-12 mb-4">
                <h2>URL:</h2>
                <select id="urlSelector" class="form-select"></select>
            </div>
            <div class="col-lg-4 col-12 mb-4">
                <h2>Filtre:</h2>
                <select id="categorySelector" class="form-select">
                    <option value="value"></option>
                    <option value="page_value">Page Value</option>
                    <option value="page_trust">Page Trust</option>
                    <option value="bas">BAS</option>
                    <option value="backlinks">Backlinks</option>
                    <option value="outlinks">Outlinks</option>
                </select>
            </div>
        </div>
        <canvas id="barChart" width="400" height="400"></canvas>
    </div>
</div>

    <script>


     document.addEventListener('DOMContentLoaded', function () {
        var anchorSelector = document.getElementById('anchorSelector');
        var tagSelector = document.getElementById('site-selector-options');
        var urlSelector = document.getElementById('urlSelector');
        var categorySelector = document.getElementById('categorySelector');
        var barChartCtx = document.getElementById('barChart').getContext('2d');
        var barChart;

        function updateAnchors(tag) {
            fetch('/get_anchor_data_tag?tag=' + tag)
                .then(response => response.json())
                .then(data => {
                    anchorSelector.innerHTML = '';
                    data.forEach(function (entry) {
                        let option = document.createElement('option');
                        option.value = entry.anchor;
                        option.textContent = entry.anchor;
                        anchorSelector.appendChild(option);
                    });

                    // Sélectionner la première ancre par défaut s'il y en a
                    if (data.length > 0) {
                        anchorSelector.selectedIndex = 0;
                        updateChart(); // Appeler la fonction pour mettre à jour le graphique avec l'ancre par défaut
                    }
                })
                .catch(error => {
                    console.error('Erreur lors de la récupération des ancres', error);
                });
        }

        // Écouteur d'événements pour le changement de tag
        tagSelector.addEventListener('change', function () {
            var selectedTag = tagSelector.value;
            updateAnchors(selectedTag); // Mettre à jour les ancres en fonction du tag sélectionné
        });

        // Appel initial pour mettre à jour les ancres avec le tag par défaut
        var defaultTagOption = document.querySelector('#site-selector-options option:not([value=""])');
        if (defaultTagOption) {
            var selectedTag = defaultTagOption.value;
            updateAnchors(selectedTag);
        } else {
            console.error('Aucune option de tag trouvée après "Sélectionnez une catégorie".');
        }


            // Créer une option vide pour anchorSelector
            var emptyAnchorOption = document.createElement('option');
            emptyAnchorOption.value = '';
            emptyAnchorOption.textContent = 'Sélectionner une ancre';

            // Insérer l'option vide au début de la liste des options
            anchorSelector.insertBefore(emptyAnchorOption, anchorSelector.firstChild);

            // Créer une option vide pour urlSelector
            var emptyUrlOption = document.createElement('option');
            emptyUrlOption.value = '';
            emptyUrlOption.textContent = 'Sélectionner une URL';

            // Insérer l'option vide au début de la liste des options
            urlSelector.insertBefore(emptyUrlOption, urlSelector.firstChild);

            // Écouteur d'événements pour la sélection d'ancre
            anchorSelector.addEventListener('change', function () {
                var selectedAnchor = anchorSelector.value;

                // Effectuer une requête pour obtenir les URLs en fonction de l'ancre sélectionnée
                fetch('/get_urls?anchor_text=' + selectedAnchor)
                    .then(response => response.json())
                    .then(data => {
                        // Effacer les options actuelles
                        urlSelector.innerHTML = '';

                        // Ajouter de nouvelles options basées sur les données renvoyées
                        data.forEach(function (url) {
                            let option = document.createElement('option');
                            option.value = url;
                            option.textContent = url;
                            urlSelector.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Erreur lors de la récupération des URLs', error);
                    });
            });

            // Écouteur d'événements pour les changements d'URL ou de catégorie
            urlSelector.addEventListener('change', updateChart);
            categorySelector.addEventListener('change', updateChart);

            // Fonction pour mettre à jour le graphique
            function updateChart() {
                var selectedAnchor = anchorSelector.value;
                var selectedURL = urlSelector.value;
                var selectedCategory = categorySelector.value;

                // Nettoyer le graphique existant s'il existe
                if (barChart) {
                    barChart.destroy();
                }

                // Effectuer une requête pour obtenir les valeurs spécifiques à l'URL sélectionnée et à la catégorie sélectionnée
                fetch('/get_values?anchor_text=' + selectedAnchor + '&url=' + selectedURL)
                    .then(response => response.json())
                    .then(data => {
                        // Traiter les données et mettre à jour le graphique
                        var monthNames = ["Jan", "Fév", "Mar", "Avr", "Mai", "Juin", "Juil", "Août", "Sep", "Oct", "Nov", "Déc"];
                        var pairs = data.last_checked.map((date, index) => {
                            return {
                                date: new Date(date),
                                value: data[selectedCategory][index]
                            };
                        });

                        var monthlyValues = {};
                        pairs.forEach(pair => {
                            var month = pair.date.getMonth();
                            if (!(month in monthlyValues) || pair.date > monthlyValues[month].date) {
                                monthlyValues[month] = pair;
                            }
                        });

                        var sortedMonths = Object.keys(monthlyValues).sort((a, b) => a - b);
                        var dates = sortedMonths.map(month => monthNames[month]);
                        var values = sortedMonths.map(month => monthlyValues[month].value);

                        // Créer un nouveau graphique à ligne pour afficher les nouvelles données
                        barChart = new Chart(barChartCtx, {
                            type: 'line',
                            data: {
                                labels: dates,
                                datasets: [{
                                    label: selectedCategory,
                                    data: values,
                                    borderColor: '#007bff', // couleur bleue
                                    fill: false
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: selectedCategory
                                        }
                                    },
                                    x: {
                                        title: {
                                            display: true,
                                            text: 'Mois de vérification'
                                        }
                                    }
                                }
                            }
                        });
                    })
                    .catch(error => {
                        console.error('Erreur lors de la récupération des valeurs', error);
                    });
            }
});
            </script>

            </div>
            </div>
            </div>
            </div>

   <!-- Ajoutez le conteneur de texte pour la répartition par site -->
    <div id="repartitionParSiteGraphs" style="display: none;">

       
        <div>
            <H4 style="margin-left: 630px; margin-top: 80px; margin-bottom: 120px; font-size: 36px;">La répartition des graphs pas Site</H4>
         </div>


         <div id="selector-container" style=" margin-top: -50px; margin-left: 200px;">
            <label for="site-selector" style="font-size: 25px;">Choisissez un site :</label>
            <select id="site-selector-options1">
                    {% for tag in tag_data %}
                        <option value="{{ tag.tag }}">{{ tag.tag }}</option>
                    {% endfor %}
                
            </select>
        </div>
    

        <div class="container">
            <!-- Première ligne : Tableau à gauche, Graphique à droite -->
            <div class="row mb-4">
                <div class="col-lg-6 col-12 mb-4">
                    <!-- Tableau des Ancres -->
                    <div class="table-container" id="tag-table-container">
                        <h2>Tableau des Domaines</h2>
                        <table id="anchor-table">
                            <thead>
                                <tr>
                                    <th>Domaine</th>
                                    <th>Nombre</th>
                                    <th>Pourcentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Les données d'ancres seront ajoutées ici dynamiquement -->
                            </tbody>
                        </table>
                        <div>
                            <button id="prev-btn"class="custom-button">Précédent</button>
                            <button id="next-btn" class="custom-button">Suivant</button>
                        </div>
                    </div>
                </div>
            
    <script>
    document.addEventListener('DOMContentLoaded', function () {
    var siteSelector = document.getElementById('site-selector-options1');
    var anchorTableBody = document.querySelector('#anchor-table tbody');
    var currentPage = 1;
    var perPage = 10;
    var selectedTag = '';

    function fetchData(page, tag) {
        // Effectuer une requête au backend pour récupérer les données d'ancres paginées du tag sélectionné
        fetch(`/get_domaine_tag?tag=${tag}&offset=${(page - 1) * perPage}&limit=${perPage}`)
            .then(response => response.json())
            .then(data => {
                // Effacer le contenu actuel du tableau
                anchorTableBody.innerHTML = '';

                // Ajouter les nouvelles données paginées dans le tableau
                data.forEach(anchor => {
                    var row = `<tr>
                        <td>${anchor.domain}</td>
                        <td>${anchor.count}</td>
                        <td>${anchor.percentage}</td>
                    </tr>`;
                    anchorTableBody.innerHTML += row;
                });
            })
            .catch(error => {
                console.error('Erreur lors de la récupération des données d\'ancres', error);
            });
    }

    // Charger les données de la première page au chargement initial
    siteSelector.addEventListener('change', function () {
        currentPage = 1;
        selectedTag = siteSelector.value;
        fetchData(currentPage, selectedTag);
    });

    // Sélectionner le tag par défaut et charger les données de la première page
    selectedTag = siteSelector.value;
    fetchData(currentPage, selectedTag);

    // Écouteur d'événements pour le changement de page
    document.getElementById('next-btn').addEventListener('click', function () {
        currentPage++;
        fetchData(currentPage, selectedTag);
    });

    document.getElementById('prev-btn').addEventListener('click', function () {
        if (currentPage > 1) {
            currentPage--;
            fetchData(currentPage, selectedTag);
        }
    });
});
            </script>             

                <div class="col-lg-6 col-12 mb-4">
                    <!-- Graphique des Sites -->
                    <div id="site-chart-container" class="chart-container">
                        <h2>Répartition des Backlinks par Domaine</h2>
                        <canvas id="sitePieChart" width="200" height="200"></canvas>
                        <!-- Script pour le graphique en camembert -->
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                var siteSelector = document.getElementById('site-selector-options1');
                
                                // Écouteur d'événements pour le changement de sélection du site
                                siteSelector.addEventListener('change', function () {
                                    var selectedTag = siteSelector.value;
                
                                    // Effectuer une requête au backend pour récupérer les domain_stats du tag sélectionné
                                    fetch('/get_domaine_tag_backlinks?tag=' + selectedTag)
                                        .then(response => response.json())
                                        .then(domainStats => {
                                            // Mettre à jour le graphique avec les nouvelles données
                                            updateSitePieChart(domainStats);
                                        })
                                        .catch(error => {
                                            console.error('Erreur lors de la récupération des données de domaine', error);
                                        });
                                });
                
                                // Sélectionnez la première option après "Sélectionnez un site" par défaut
                                var defaultTag = siteSelector.firstElementChild.value;
                                fetch('/get_domaine_tag_backlinks?tag=' + defaultTag)
                                    .then(response => response.json())
                                    .then(domainStats => {
                                        // Mettre à jour le graphique avec les données du premier tag par défaut
                                        updateSitePieChart(domainStats);
                                    })
                                    .catch(error => {
                                        console.error('Erreur lors de la récupération des données de domaine', error);
                                    });
                
                                function updateSitePieChart(domainStats) {
                                    var siteLabels = domainStats.map(item => item.domain);
                                    var siteCounts = domainStats.map(item => item.count);
                
                                    var ctx = document.getElementById('sitePieChart').getContext('2d');
                
                                    // Si une instance de graphique existe déjà, détruisez-la
                                    if (window.sitePieChart instanceof Chart && typeof window.sitePieChart.destroy === 'function') {
                                        window.sitePieChart.destroy();
                                    }
                
                                    // Créez une nouvelle instance de Chart.js
                                    window.sitePieChart = new Chart(ctx, {
                                        type: 'pie',
                                        data: {
                                            labels: siteLabels,
                                            datasets: [{
                                                data: siteCounts,
                                                backgroundColor: generateRandomColors(siteLabels.length)
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            maintainAspectRatio: true
                                        }
                                    });
                                }
                
                                // Fonction pour générer des couleurs aléatoires
                                function generateRandomColors(numColors) {
                                    var colors = [];
                                    for (var i = 0; i < numColors; i++) {
                                        var randomColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
                                        colors.push(randomColor);
                                    }
                                    return colors;
                                }
                            });
                        </script>
                    </div>
                </div>

            <!-- Deuxième ligne : Graphique à gauche, Tableau à droite -->
            <div class="row mb-4">
                <div class="col-lg-6 col-12 mb-4">
                    <!-- Graphique des Statuts HTTP -->
                    <div id="http-status-chart-containecr" class="chart-container">
                        <h2>Statut HTTP des Backlinks par domaines</h2>
                        <canvas id="httpStatusChart1"></canvas>
                    </div>
                </div>
           
                <script>
                    // Fonction pour mettre à jour le graphique des statuts HTTP
                    function updateHttpStatusChart1(data) {
                        var ctx = document.getElementById('httpStatusChart1').getContext('2d');
                
                        // Vérifier si une instance de graphique existe déjà
                        if (window.httpStatusChart1 instanceof Chart) {
                            window.httpStatusChart1.destroy(); // Détruire l'instance existante du graphique
                        }
                
                        var datasets = [];
                
                        // Couleurs pour les différentes catégories de statuts HTTP
                        var colors = {
                            '200': 'rgba(75, 192, 192, 0.2)',
                            '3XX': 'rgba(255, 206, 86, 0.2)',
                            '4XX': 'rgba(255, 99, 132, 0.2)',
                            '5XX': 'rgba(54, 162, 235, 0.2)'
                        };
                
                        // Parcourir les données de chaque domaine
                        for (var domain in data) {
                            if (data.hasOwnProperty(domain)) {
                                var counts = data[domain];
                                datasets.push({
                                    label: domain, // Utiliser le domaine comme étiquette
                                    data: [counts['200'], counts['3XX'], counts['4XX'], counts['5XX']],
                                    backgroundColor: [
                                        colors['200'],
                                        colors['3XX'],
                                        colors['4XX'],
                                        colors['5XX']
                                    ],
                                    borderColor: [
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)'
                                    ],
                                    borderWidth: 1
                                });
                            }
                        }
                
// Créer un nouveau graphique de type Cercles concentriques
// Créer un nouveau graphique de type Cercles concentriques
window.httpStatusChart1 = new Chart(ctx, {
    type: 'polarArea', // Changer le type de graphique à polarArea (Cercles concentriques)
    data: {
        labels: ['200', '3XX', '4XX', '5XX'],
        datasets: datasets
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        },
        plugins: {
            legend: {
                position: 'right' // Positionner la légende à droite du graphique
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        var label = datasets[context.datasetIndex].label || '';
                        var value = datasets[context.datasetIndex].data[context.dataIndex] || 0;
                        return label + ': ' + value;
                    },
                    title: function(context) {
                        var domain = datasets[context[0].datasetIndex].label || '';
                        return domain;
                    }
                },
                position: 'average', // Position moyenne de l'infobulle pour éviter le chevauchement
                intersect: false // Infobulle ne se superpose pas aux autres éléments
            }
        }
    }
});

                    }
                
                    // Fonction pour récupérer les données des statuts HTTP en fonction du tag sélectionné
                    function fetchStatusDataAndUpdate1(tag) {
                        fetch('/get_status_counts_domain_tag?tag=' + tag)
                            .then(response => response.json())
                            .then(data => {
                                updateHttpStatusChart1(data);
                            })
                            .catch(error => console.error('Erreur lors de la récupération des données de statut : ', error));
                    }
                
                    document.addEventListener('DOMContentLoaded', function() {
                        // Gestionnaire d'événements pour la sélection d'un nouveau tag
                        document.getElementById('site-selector-options1').addEventListener('change', function() {
                            var selectedTag = this.value; // Récupérer la valeur sélectionnée dans la liste déroulante
                            fetchStatusDataAndUpdate1(selectedTag); // Mettre à jour les données du graphique en fonction du tag sélectionné
                        });
                
                        // Sélectionner automatiquement le premier tag
                        var firstTagOption = document.querySelector('#site-selector-options1 option:not([disabled])');
                        if (firstTagOption) {
                            firstTagOption.selected = true;
                            fetchStatusDataAndUpdate1(firstTagOption.value); // Mettre à jour les données du graphique avec le premier tag
                        }
                    });
                </script>
       

       <div class="col-lg-6 col-12 mb-4">
        <!-- Tableau des Statuts HTTP -->
        <div class="table-container">
            <h2>Tableau des Statuts HTTP par domaine</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Domaine</th>
                        <th>Statut HTTP</th>
                        <th>Nombre de Pages</th>
                    </tr>
                </thead>
                <tbody id="status-table-body">
                    <!-- Les données seront ajoutées ici dynamiquement -->
                </tbody>
            </table>
            <!-- Pagination -->
            <div class="pagination">
                <button id="prev-page-btn" class="custom-button" onclick="getPreviousPage(1)">Précédent</button>
                <button id="next-page-btn" class="custom-button" onclick="getNextPage(1)">Suivant</button>
            </div>
        </div>
    </div>
    
    <script>
        var selectedTag;
var currentPage = 1; // Initialiser la page actuelle

// Fonction pour récupérer les données des statuts HTTP en fonction du tag sélectionné et de la page
function fetchStatusDataAndUpdateTable(tag, page) {
    
    fetch('/get_status_counts_domain_table_tag?tag=' + tag + '&page=' + page)
        .then(response => response.json())
        .then(data => {
            updateStatusTable1(data);
        })
        .catch(error => console.error('Erreur lors de la récupération des données de statut : ', error));
}

function updateStatusTable1(data) {
    var statusTableBody = document.getElementById('status-table-body');
    statusTableBody.innerHTML = ''; // Effacer le contenu actuel du tableau

    // Parcourir les données de chaque domaine
    for (var domain in data.data) {
        if (data.data.hasOwnProperty(domain)) {
            var counts = data.data[domain];
            for (var statusCode in counts) {
                if (counts.hasOwnProperty(statusCode)) {
                    var count = counts[statusCode];
                    if (count > 0) { // Ajouter cette condition pour filtrer les valeurs > 0
                        var row = '<tr><td>' + domain + '</td><td>' + statusCode + '</td><td>' + count + '</td></tr>';
                        statusTableBody.innerHTML += row;
                    }
                }
            }
        }
    }

    // Mettre à jour les boutons de pagination
    var prevPageBtn = document.getElementById('prev-page-btn');
    var nextPageBtn = document.getElementById('next-page-btn');
    
    // Désactiver le bouton "Précédent" si nous sommes sur la première page
    prevPageBtn.disabled = data.current_page === 1;

    // Activer ou désactiver le bouton "Suivant" en fonction de la page actuelle et du nombre total de pages
    nextPageBtn.disabled = data.current_page === data.total_pages;

    // Mettre à jour la valeur de la page actuelle
    currentPage = data.current_page;
}

// Fonction pour récupérer la page précédente
function getPreviousPage() {
    fetchStatusDataAndUpdateTable(selectedTag, currentPage - 1);
}

// Fonction pour récupérer la page suivante
function getNextPage() {
    fetchStatusDataAndUpdateTable(selectedTag, currentPage + 1);
}

document.addEventListener('DOMContentLoaded', function() {
    var selector = document.getElementById('site-selector-options1');
    selectedTag = selector.value;
    console.log("Tag initial sélectionné :", selectedTag);
    selector.addEventListener('change', function() {
        selectedTag = selector.value;
        currentPage = 1; // Réinitialiser la page à 1 lors du changement de tag
        fetchStatusDataAndUpdateTable(selectedTag, currentPage); // Mettre à jour les données du tableau avec le premier tag et la première page
    });
    fetchStatusDataAndUpdateTable(selectedTag, currentPage); // Mettre à jour les données du tableau avec le premier tag et la première page
});
    </script>

           <!-- Ligne pour le graphique Follow vs NoFollow et son tableau -->
           <div class="container">
            <div class="row mb-4">
                <div class="col-lg-6 col-12 mb-4">
                    <!-- Tableau Follow vs NoFollow -->
                    <div class="table-container">
                        <h2>Tableau Follow vs NoFollow par domaine</h2>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Domaine</th>
                                    <th>Type de Lien</th>
                                    <th>Nombre de Liens</th>
                                </tr>
                            </thead>
                            <tbody id="link-status-table-body">
                                
                            </tbody>
                        </table>
                         <div class="pagination">
                    <button id="prev-page-btn" class="custom-button" onclick="getPreviousPage()">Précédent</button>
                    <button id="next-page-btn" class="custom-button" onclick="getNextPage()">Suivant</button>
                </div>
                    </div>

                    <script>
                        var selectedTag;
                        var currentPage = 1; // Initialiser la page actuelle
                    
                        // Fonction pour récupérer les données des statuts des liens en fonction du tag sélectionné et de la page
                        function fetchLinkStatusDataAndUpdateTable(tag, page) {
                            fetch('/get_link_follow_status_counts_domain_table_tag?tag=' + tag + '&page=' + page)
                                .then(response => response.json())
                                .then(data => {
                                    updateLinkStatusTable(data);
                                })
                                .catch(error => console.error('Erreur lors de la récupération des données de statut des liens : ', error));
                        }
                    
                        function updateLinkStatusTable(data) {
                            var linkStatusTableBody = document.getElementById('link-status-table-body');
                            linkStatusTableBody.innerHTML = ''; // Effacer le contenu actuel du tableau
                    
                            // Parcourir les données de chaque domaine
                            for (var domain in data.data) {
                                if (data.data.hasOwnProperty(domain)) {
                                    var counts = data.data[domain];
                                    var row = '<tr><td>' + domain + '</td><td>' + counts.follow + '</td><td>' + counts.nofollow + '</td></tr>';
                                    linkStatusTableBody.innerHTML += row;
                                }
                            }
                    
                            // Mettre à jour les boutons de pagination
                            var prevPageBtn = document.getElementById('prev-page-btn');
                            var nextPageBtn = document.getElementById('next-page-btn');
                            
                            // Désactiver le bouton "Précédent" si nous sommes sur la première page
                            prevPageBtn.disabled = data.current_page === 1;
                    
                            // Activer ou désactiver le bouton "Suivant" en fonction de la page actuelle et du nombre total de pages
                            nextPageBtn.disabled = data.current_page === data.total_pages;
                    
                            // Mettre à jour la valeur de la page actuelle
                            currentPage = data.current_page;
                        }
                    
                        // Fonction pour récupérer la page précédente
                        function getPreviousPage() {
                            fetchLinkStatusDataAndUpdateTable(selectedTag, currentPage - 1);
                        }
                    
                        // Fonction pour récupérer la page suivante
                        function getNextPage() {
                            fetchLinkStatusDataAndUpdateTable(selectedTag, currentPage + 1);
                        }
                    
                        document.addEventListener('DOMContentLoaded', function() {
                            var selector = document.getElementById('site-selector-options1');
                            selectedTag = selector.value;
                            selector.addEventListener('change', function() {
                                selectedTag = selector.value;
                                currentPage = 1; // Réinitialiser la page à 1 lors du changement de tag
                                fetchLinkStatusDataAndUpdateTable(selectedTag, currentPage); // Mettre à jour les données du tableau avec le premier tag et la première page
                            });
                            fetchLinkStatusDataAndUpdateTable(selectedTag, currentPage); // Mettre à jour les données du tableau avec le premier tag et la première page
                        });
                    </script>
                </div>


            <div class="col-lg-6 col-12 mb-4">
                <!-- Graphique de Répartition des URLs Source -->
                <div id="source-url-pie-chart-container" class="chart-container">
                    <h2>Répartition des URLs Source</h2>
                    <canvas id="sourceUrlPieChart1" width="300" height="300"></canvas>
                    <!-- Script pour le graphique en camembert -->
                 
                    <script>
                        function generateRandomColors(numColors) {
                            var colors = [];
                            for (var i = 0; i < numColors; i++) {
                                var randomColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
                                colors.push(randomColor);
                            }
                            return colors;
                        }
                    
                        function fetchAndUpdateChart(tag) {
                            fetch('/get_source_url_counts_tag?tag=' + tag)
                                .then(response => response.json())
                                .then(data => {
                                    var sourceUrlLabels1 = ['Présentes', 'Absentes'];
                                    var sourceUrlCounts1 = [data['Lien présent'], data['Lien absent']];
                    
                                    var ctx = document.getElementById('sourceUrlPieChart1').getContext('2d');
                                    var existingChart = window.sourceUrlPieChart1;
                    
                                    if (existingChart && typeof existingChart.destroy === 'function') {
                                        existingChart.destroy();
                                    }
                    
                                    window.sourceUrlPieChart1 = new Chart(ctx, {
                                        type: 'pie',
                                        data: {
                                            labels: sourceUrlLabels1,
                                            datasets: [{
                                                data: sourceUrlCounts1,
                                                backgroundColor: generateRandomColors(2)
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            maintainAspectRatio: true,
                                        }
                                    });
                                })
                                .catch(error => console.error('Erreur lors de la récupération des données source_url_counts : ', error));
                        }
                    
                        // Appel initial pour afficher les données par défaut
                        document.addEventListener('DOMContentLoaded', function () {
                            var selector = document.getElementById('site-selector-options1');
                            selector.addEventListener('change', function () {
                                var selectedTag = this.value;
                                fetchAndUpdateChart(selectedTag);
                            });
                    
                            var defaultTagOption = selector.querySelector('option:not([value=""])');
                            if (defaultTagOption) {
                                var selectedTag = defaultTagOption.value;
                                fetchAndUpdateChart(selectedTag);
                            } else {
                                console.error('Aucune option de tag trouvée après "Sélectionnez un site".');
                            }
                        });
                    </script>

                </div>
            </div> 


      <!-- Graphique de Statut d'Indexation Google par Ancre -->
      <div class="col-lg-6 col-12 mb-4">
        <div id="google-index-chart-container" class="chart-container">
             <h2>Statut d'Indexation Google par Site</h2>
                <canvas id="googleIndexChart1"></canvas>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var selector = document.getElementById('site-selector-options1');
                selector.addEventListener('change', function () {
                    var selectedTag = selector.value;
                    fetchGoogleIndexDataByDomain(selectedTag);
                });
    
                var initialTag = selector.value;
                fetchGoogleIndexDataByDomain(initialTag);
            });
    
    
            function fetchGoogleIndexDataByDomain(tag) {
                fetch('/get_google_index_data_by_domain?tag=' + tag)
                    .then(response => response.json())
                    .then(data => {
                        renderGoogleIndexBarChart(data);
                    })
                    .catch(error => console.error('Erreur lors de la récupération des données d\'indexation Google : ', error));
            }
    
            function renderGoogleIndexBarChart(data) {
    

    var domains = Object.keys(data.domains);
    var indexedCounts = domains.map(domain => data.domains[domain].indexed);
    var notIndexedCounts = domains.map(domain => data.domains[domain].not_indexed);

    var ctx = document.getElementById('googleIndexChart1').getContext('2d');

    // Destruction du graphique précédent s'il existe
    if (window.googleIndexBarChart) {
        window.googleIndexBarChart.destroy();
    }

    window.googleIndexBarChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: domains,
            datasets: [{
                label: 'Indexé',
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                data: indexedCounts
            }, {
                label: 'Non indexé',
                backgroundColor: 'rgba(255, 99, 132, 0.5)',
                data: notIndexedCounts
            }]
        },
        options: {
            scales: {
                x: {
                    stacked: true,
                    title: {
                        display: true,
                        text: 'Domaine'
                    }
                },
                y: {
                    stacked: true,
                    title: {
                        display: true,
                        text: 'Nombre d\'indexations'
                    },
                    beginAtZero: true
                }
            }
        }
    });
}
        </script>
    
   </div>


        <div class="col-lg-6 col-12 mb-4">
            <div id="anchorDiversityChartContainer1" class="chart-container">
                <h2>Diversité des Sites</h2>
                <canvas id="siteDiversityChart" width="400" height="400"></canvas>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Récupérer les données de la vue
                var tagStats = {{ tag_stats1|tojson }};
                
                // Créer une liste de couleurs pour chaque tag
                var colors = generateColors(tagStats.length);

                // Créer une structure de données pour le graphique
                var siteDiversityChartData = {
                    labels: tagStats.map(data => data.tag),
                    datasets: [{
                        label: 'Nombre de Sites',
                        data: tagStats.map(data => data.count),
                        backgroundColor: colors,
                        borderColor: colors,
                        borderWidth: 1,
                    }]
                };

                // Configurer le graphique
                var siteDiversityChartCtx = document.getElementById('siteDiversityChart').getContext('2d');
                var siteDiversityChart = new Chart(siteDiversityChartCtx, {
                    type: 'bar',  // Vous pouvez utiliser 'horizontalBar' si vous préférez un graphique horizontal
                    data: siteDiversityChartData,
                    options: {
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Tags',
                                },
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Nombre de Site',
                                },
                            }
                        }
                    },
                });

                // Fonction pour générer des couleurs de manière aléatoire
                function generateColors(count) {
                    var colors = [];
                    for (var i = 0; i < count; i++) {
                        colors.push(getRandomColor());
                    }
                    return colors;
                }

                // Fonction pour générer une couleur aléatoire
                function getRandomColor() {
                    var letters = '0123456789ABCDEF';
                    var color = '#';
                    for (var i = 0; i < 6; i++) {
                        color += letters[Math.floor(Math.random() * 16)];
                    }
                    return color;
                }
            });

        </script>


                <div class="col-lg-6 col-12 mb-4">
                    <div id="barChartContainer1" class="chart-container">
                        <h2>Graphique temporelle</h2>
                        <div class="row">
                            <div class="col-lg-4 col-12 mb-4">
                                <h2>Domaines:</h2>
                                <select id="domainSelector" class="form-select"></select>
                            </div>
                            <div class="col-lg-4 col-12 mb-4">
                                <h2>URL:</h2>
                                <select id="urlSelector1" class="form-select"></select>
                            </div>
                            <div class="col-lg-4 col-12 mb-4">
                                <h2>Filtre:</h2>
                                <select id="categorySelector1" class="form-select">
                                    <option value="value"></option>
                                    <option value="page_value">Page Value</option>
                                    <option value="page_trust">Page Trust</option>
                                    <option value="bas">BAS</option>
                                    <option value="backlinks">Backlinks</option>
                                    <option value="outlinks">Outlinks</option>
                                </select>
                            </div>
                        </div>
                        <canvas id="barChart1" width="400" height="400"></canvas>
                    </div>
                </div>
                
               <script>
              document.addEventListener('DOMContentLoaded', function() {
                var tagSelector = document.getElementById('site-selector-options1');
                var urlSelector = document.getElementById('urlSelector1');
                var categorySelector = document.getElementById('categorySelector1');
                var barChartCtx = document.getElementById('barChart1').getContext('2d');
                var barChart;

                // Fonction pour récupérer les domaines depuis le backend et mettre à jour le sélecteur
                function fetchDomainsAndUpdateSelector(tag) {
                    fetch(`/get_domain?tag=${tag}`)
                        .then(response => response.json())
                        .then(data => {
                            const domainSelector = document.getElementById('domainSelector');
                            domainSelector.innerHTML = ''; // Effacer les options actuelles

                            data.forEach(domain => {
                                const option = document.createElement('option');
                                option.value = domain;
                                option.textContent = domain;
                                domainSelector.appendChild(option);
                            });
                        })
                        .catch(error => console.error('Erreur lors de la récupération des domaines : ', error));
                }

                // Fonction pour récupérer les URLs du domaine sélectionné
                function fetchUrlsAndUpdateSelector(domain) {
                    fetch(`/get_urls_by_domain?domain=${domain}`)
                        .then(response => response.json())
                        .then(data => {
                            const urlSelector = document.getElementById('urlSelector1');
                            urlSelector.innerHTML = ''; // Effacer les options actuelles

                            data.forEach(url => {
                                const option = document.createElement('option');
                                option.value = url;
                                option.textContent = url;
                                urlSelector.appendChild(option);
                            });
                        })
                        .catch(error => console.error('Erreur lors de la récupération des URLs : ', error));
                }

                // Fonction pour mettre à jour le graphique
                function updateChart() {
                    var selectedTag = tagSelector.value;
                    var selectedURL = urlSelector.value;
                    var selectedCategory = categorySelector.value;

                    // Nettoyer le graphique existant s'il existe
                    if (barChart) {
                        barChart.destroy();
                    }

                    // Effectuer une requête pour obtenir les valeurs spécifiques à l'URL sélectionnée et à la catégorie sélectionnée
                    fetch(`/get_values_filter_tags?tags=${selectedTag}&url=${selectedURL}`)
                        .then(response => response.json())
                        .then(data => {
                            // Traiter les données et mettre à jour le graphique
                            var monthNames = ["Jan", "Fév", "Mar", "Avr", "Mai", "Juin", "Juil", "Août", "Sep", "Oct", "Nov", "Déc"];
                            var pairs = data.last_checked.map((date, index) => {
                                return {
                                    date: new Date(date),
                                    value: data[selectedCategory][index]
                                };
                            });

                            var monthlyValues = {};
                            pairs.forEach(pair => {
                                var month = pair.date.getMonth();
                                if (!(month in monthlyValues) || pair.date > monthlyValues[month].date) {
                                    monthlyValues[month] = pair;
                                }
                            });

                            var sortedMonths = Object.keys(monthlyValues).sort((a, b) => a - b);
                            var dates = sortedMonths.map(month => monthNames[month]);
                            var values = sortedMonths.map(month => monthlyValues[month].value);

                            // Créer un nouveau graphique à ligne pour afficher les nouvelles données
                            barChart = new Chart(barChartCtx, {
                                type: 'line',
                                data: {
                                    labels: dates,
                                    datasets: [{
                                        label: selectedCategory,
                                        data: values,
                                        borderColor: '#007bff', // couleur bleue
                                        fill: false
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            title: {
                                                display: true,
                                                text: selectedCategory
                                            }
                                        },
                                        x: {
                                            title: {
                                                display: true,
                                                text: 'Mois de vérification'
                                            }
                                        }
                                    }
                                }
                            });
                        })
                        .catch(error => {
                            console.error('Erreur lors de la récupération des valeurs', error);
                        });
                }

                // Gestionnaire d'événements pour le changement de tag
                document.getElementById('site-selector-options1').addEventListener('change', function() {
                    const selectedTag = this.value; // Récupérer la valeur sélectionnée
                    fetchDomainsAndUpdateSelector(selectedTag); // Mettre à jour le sélecteur de domaines
                });

                // Gestionnaire d'événements pour le changement de sélection de domaine
                document.getElementById('domainSelector').addEventListener('change', function() {
                    const selectedDomain = this.value; // Récupérer le domaine sélectionné
                    fetchUrlsAndUpdateSelector(selectedDomain); // Mettre à jour le sélecteur d'URLs
                });

                // Gestionnaire d'événements pour les changements de catégorie
                categorySelector.addEventListener('change', function() {
                    updateChart(); // Appel de la fonction updateChart pour mettre à jour le graphique en fonction de la nouvelle catégorie sélectionnée
                });

                // Appel initial pour afficher les domaines correspondant à la première option
                const defaultTagOption = document.querySelector('#site-selector-options1 option:not([value=""])');
                if (defaultTagOption) {
                    const selectedTag = defaultTagOption.value;
                    fetchDomainsAndUpdateSelector(selectedTag);
                } else {
                    console.error('Aucune option de tag trouvée après "Sélectionnez une catégorie".');
                }
            });

               </script>
                

            </div>
            </div>
            </div>
            </div>

    </div>

    <!-- Ajoutez vos scripts JavaScript ici -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var repartitionParAncreButton = document.getElementById('repartitionParAncre');
            var repartitionParSiteButton = document.getElementById('repartitionParSite');
    
            repartitionParAncreButton.addEventListener('click', function () {
                // Afficher les graphiques de répartition par ancre
                showRepartitionParAncre();
            });
    
            repartitionParSiteButton.addEventListener('click', function () {
                // Afficher le texte pour la répartition par site
                showRepartitionParSite();
            });
        });
    
        function showRepartitionParAncre() {
            // Afficher les graphiques de répartition par ancre
            // Rendre visible le conteneur des graphiques par ancre
            document.getElementById('repartitionParAncreGraphs').style.display = 'block';
    
            // Masquer le texte de répartition par site
            document.getElementById('repartitionParSiteGraphs').style.display = 'none';
        }
    
        function showRepartitionParSite() {
            // Afficher le texte de répartition par site
            document.getElementById('repartitionParSiteGraphs').style.display = 'block';
    
            // Masquer les graphiques de répartition par ancre
            // Rendre invisible le conteneur des graphiques par ancre
            document.getElementById('repartitionParAncreGraphs').style.display = 'none';
        }
    </script>


                   
</body
